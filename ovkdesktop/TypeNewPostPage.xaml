<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="ovkdesktop.TypeNewPostPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ovkdesktop"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Page header -->
        <StackPanel Grid.Row="0" Margin="125,105,20,0">
            <TextBlock Text="Новый пост" Style="{ThemeResource TitleLargeTextBlockStyle}" FontSize="42" />
            <TextBlock x:Name="ErrorTextBlock" Foreground="Red" Visibility="Collapsed" TextWrapping="Wrap" Margin="0,10,0,0"/>
        </StackPanel>

        <!-- Main content -->
        <ScrollViewer Grid.Row="1" Margin="125,25,20,20" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="10">

                <!-- Media add button -->
                <DropDownButton Content="Добавить" HorizontalAlignment="Left" x:Name="MediaAddNewPostButton">
                    <DropDownButton.Flyout>
                        <MenuFlyout Placement="Bottom">
                            <MenuFlyoutItem Text="Фото" Click="UploadPhotoButton">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE91B;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Text="Видео" Click="UploadVideoButton" IsEnabled="False">
                                <!-- support of video in typenewpostpage will be added in the future -->
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xF131;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Text="Музыка" Click="UploadAudioButton" IsEnabled="False">
                                <!-- support of audio in typenewpostpage will be added in the future -->
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE8D6;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </DropDownButton.Flyout>
                </DropDownButton>

                <!-- Text input field -->
                <TextBox
                    x:Name="NewPostTextBox"
                    TextWrapping="Wrap"
                    AcceptsReturn="True"
                    IsSpellCheckEnabled="True"
                    MinHeight="200"
                    MaxHeight="400"
                    PlaceholderText="Что у вас нового?"
                    VerticalAlignment="Stretch" />

                <!-- Attachments preview -->
                <GridView
                    x:Name="AttachmentsGridView"
                    IsItemClickEnabled="False"
                    SelectionMode="None"
                    CanDragItems="False">
                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="local:AttachmentViewModel">
                            <Grid CornerRadius="4" Width="120" Height="120">
                                <Image Source="{x:Bind Thumbnail}" Stretch="UniformToFill"/>
                                <!-- Overlay for video icon -->
                                <FontIcon
                                    Glyph="&#xE714;"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    FontSize="32"
                                    Foreground="White"
                                    Visibility="{x:Bind IsVideo, Mode=OneWay}"/>

                                <Button
                                    Click="RemoveAttachmentButton_Click"
                                    DataContext="{x:Bind}"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="5" 
                                    Width="24" 
                                    Height="24"
                                    Padding="0"
                                    BorderThickness="0"
                                    Background="#A0000000"
                                    CornerRadius="12">
                                    <ToolTipService.ToolTip>
                                        <ToolTip Content="Удалить"/>
                                    </ToolTipService.ToolTip>
                                    <FontIcon 
                                        FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                        Glyph="&#xE711;" 
                                        FontSize="10" 
                                        Foreground="White"/>
                                </Button>
                            </Grid>
                        </DataTemplate>
                    </GridView.ItemTemplate>
                </GridView>


                <!-- Action buttons -->
                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
                    <Button Content="Опубликовать" Click="PublishNewPostButton" Style="{ThemeResource AccentButtonStyle}"/>
                    <Button Content="Отмена" Click="CancelButton_Click"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

    </Grid>
</Page>